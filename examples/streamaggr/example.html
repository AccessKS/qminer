<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Example</title>
    <link rel="stylesheet" href="example.css">
</head>
<body>
    <h1>Storage and stream aggregator example</h1>
    <p>
        This is a visual representation of our storage and stream aggregators. In our base, we save random values
        from the interval [0, 100]. When we graph these values, the graph is really spikey and we cannot tell
        anything about the values.
    </p>
    <p>
        This is where our stream aggregators come in handy. By using the <b>moving average</b> stream aggregator, we smoothen
        the values and then we can tell something about the values.
    </p>
    <p>
        The graphs bellow represent the original and the smoothen values.
    </p>

    <div id="statSmooth"></div>

    <p>
        Sometimes we want to have a sample of records.
    </p>

    <div id="resampler"></div>

    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <!-- Highcharts chart representation -->
    <script>
        var socket = io();
        var stat, smooth, time;
        socket.on('getValues', function (data) {
            stat = data.stat;
            smooth = data.smooth;
            now = data.now;
        });

        var val, time, resVal, resTime;
        socket.on('resampler', function (data) {
            val = data.val;
            time = data.time;
            resVal = data.resVal;
            restime = data.restime;
        })

        $(function () {
            $(document).ready(function () {
                Highcharts.setOptions({
                    global: {
                        useUTC: false
                    }
                });
            });

            // the stat/smooth graphs
            $('#statSmooth').highcharts({
                chart: {
                    type: 'spline',
                    animation: Highcharts.svg,
                    marginRight: 10,
                    events: {
                        load: function () {
                            // set up the updating of the chart each second
                            var seriesOrigin = this.series[0],
                                seriesSmooth = this.series[1],
                                maxSamples = 10,
                                count = 0,
                                date;
                            setInterval(function () {
                                date = (new Date(now)).getTime();
                                seriesOrigin.addPoint([date, stat], false, (count >= maxSamples));
                                seriesSmooth.addPoint([date, smooth], true, (count >= maxSamples));
                                count++;
                            }, 1000);
                        }
                    }
                },
                title: {
                    text: 'Data smoothing example'
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150
                },
                yAxis: {
                    title: {
                        text: 'Values'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '<b><br/>' +
                            Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                            Highcharts.numberFormat(this.y, 4);
                    }
                },
                legend: {
                    enable: false
                },
                exporting: {
                    enable: false
                },
                series: [{
                    name: 'Original',
                    data: []
                },
                {
                    name: 'Smoothen',
                    data: []
                }]
            });
        });

    </script>
</body>
</html>